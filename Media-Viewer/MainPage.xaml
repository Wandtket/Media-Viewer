<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MediaViewer.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MediaViewer"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:MediaViewer.Converters"
    xmlns:MS="using:MediaViewer.Pages" 
    xmlns:models="using:MediaViewer.Models" 
    xmlns:controls="using:MediaViewer.Controls"   
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls" 
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity" 
    xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
    PreviewKeyDown="Page_PreviewKeyDown"
    CharacterReceived="Page_CharacterReceived"
    PreviewKeyUp="Page_PreviewKeyUp"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:ToggleToBoolConverter x:Key="ToggleToBoolConverter"/>
    </Page.Resources>

    <Page.KeyboardAccelerators>
        <KeyboardAccelerator Key="None"/>
        <KeyboardAccelerator x:Name="CopyAccelerator" Modifiers="Control" Key="C" Invoked="CopyAccelerator_Invoked"/>
        <KeyboardAccelerator x:Name="SaveAccelerator" Modifiers="Control" Key="S" Invoked="SaveAccelerator_Invoked"/>
        <KeyboardAccelerator x:Name="SpaceAccelerator"  Key="Space" Invoked="SpaceAccelerator_Invoked"/>
    </Page.KeyboardAccelerators>
    
    <!--Development Purposes Only-->
    <!--<Page.DataContext>
        <models:MediaProperties/>
    </Page.DataContext>-->

    <NavigationView x:Name="MainView" 
                x:FieldModifier="public"
                PaneDisplayMode="LeftMinimal" 
                IsSettingsVisible="True"
                PaneTitle="Media Viewer"
                PaneOpening="MainView_PaneOpening"
                PaneOpened="MainView_PaneOpened"
                PaneClosing="MainView_PaneClosing"
                PaneClosed="MainView_PaneClosed"
                SelectionChanged="MainView_SelectionChanged"
                BackRequested="MainView_BackRequested"
                IsPaneOpen="False"
                AlwaysShowHeader="True"
                IsBackButtonVisible="Collapsed">

        
        <NavigationView.MenuItems>
            <NavigationViewItem Content="Browser" Tapped="NavigationViewItem_Tapped"/>
            <NavigationViewItem x:Name="Directory" Content="Directory" Tapped="Directory_Tapped"/>
            <NavigationViewItemHeader Content="Capture Devices"/>
            
            
        </NavigationView.MenuItems>

        <NavigationView.Content>
            <Grid Background="{ThemeResource GridBackdrop}">
                <SplitView x:Name="MainViewContent"
                           x:FieldModifier="public"
                           IsPaneOpen="False" 
                           PanePlacement="Right" 
                           OpenPaneLength="400" 
                           DisplayMode="Inline" 
                           PaneBackground="Transparent">
                
                    <SplitView.Content>
                        <Frame x:Name="PageFrame" 
                               Navigated="PageFrame_Navigated"
                               x:FieldModifier="public" 
                               Margin="0,45,0,0"/>
                    </SplitView.Content>
                    
                    <SplitView.Pane>
                        <controls:InfoPanel 
                            DataContext="{Binding}"
                            Dismissed="InfoPanel_Dismissed"/>
                    </SplitView.Pane>
                </SplitView>

                <Grid x:Name="HeaderGrid" 
                      Height="48"
                      VerticalAlignment="Top"
                      Margin="0,-1,0,0"
                      PointerMoved="HeaderGrid_PointerMoved"
                      Background="{ThemeResource CustomAcrylicBrush}">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition x:Name="WindowButtonMargins" 
                                          Width="135"/>
                    </Grid.ColumnDefinitions>

                    <Grid.Resources>
                        <Storyboard x:Name="FadeIn">
                            <DoubleAnimation Storyboard.TargetName="HeaderGrid"
                             Storyboard.TargetProperty="Opacity"
                             To="1" Duration="0:0:0.2"/>
                        </Storyboard>
                        <Storyboard x:Name="FadeOut">
                            <DoubleAnimation Storyboard.TargetName="HeaderGrid"
                             Storyboard.TargetProperty="Opacity"
                             To="0" Duration="0:0:0.2"/>
                        </Storyboard>
                    </Grid.Resources>

                    <Button x:Name="Editbutton" VerticalAlignment="Top" Margin="50,8,0,0"
                            Tapped="Editbutton_Tapped">
                        
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE70F;" FontSize="14"/>
                            <TextBlock Text="Edit"/>
                        </StackPanel>
                    </Button>

                    <CommandBar x:Name="MediaMenuCommandBar" 
                                HorizontalAlignment="Left" 
                                DefaultLabelPosition="Collapsed"
                                Grid.Column="1" Margin="0,0,0,0"
                                Background="Transparent">

                        <CommandBar.PrimaryCommands>

                            <AppBarButton x:Name="RotateButton" 
                                          x:FieldModifier="public"
                                          Label="Rotate" 
                                          Width="50"
                                          Tapped="RotateButton_Tapped">
                                <AppBarButton.Icon>
                                    <SymbolIcon Symbol="Rotate"/>
                                </AppBarButton.Icon>
                            </AppBarButton>

                            <AppBarButton x:Name="ShareButton" 
                                          Tapped="ShareButton_Tapped"
                                          Label="Share" 
                                          Width="50">
                                <AppBarButton.Icon>
                                    <SymbolIcon Symbol="Share"/>
                                </AppBarButton.Icon>
                            </AppBarButton>

                        </CommandBar.PrimaryCommands>


                        <CommandBar.SecondaryCommands>

                            <AppBarButton x:Name="ResizeButton" Label="Resize Image">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE61F;" />
                                </AppBarButton.Icon>
                            </AppBarButton>
                            <AppBarButton x:Name="CropButton" Label="Crop Image">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE7A8;" />
                                </AppBarButton.Icon>
                            </AppBarButton>
                            <AppBarSeparator/>

                            <AppBarButton x:Name="SaveAsButton" Label="Save As" Icon="Save">
                                <AppBarButton.KeyboardAccelerators>
                                    <KeyboardAccelerator Modifiers="Control" Key="S" />
                                </AppBarButton.KeyboardAccelerators>
                            </AppBarButton>
                            <AppBarButton x:Name="CopyButton" Label="Copy" Icon="Copy">
                                <AppBarButton.KeyboardAccelerators>
                                    <KeyboardAccelerator Modifiers="Control" Key="C" />
                                </AppBarButton.KeyboardAccelerators>
                            </AppBarButton>
                            <AppBarButton x:Name="DeleteButton" Label="Delete" Icon="Delete">
                                <AppBarButton.KeyboardAccelerators>
                                    <KeyboardAccelerator Key="Delete" />
                                </AppBarButton.KeyboardAccelerators>
                            </AppBarButton>
                            <AppBarSeparator/>
                            <AppBarButton x:Name="PrintButton" Label="Print" Icon="Print">
                                <AppBarButton.KeyboardAccelerators>
                                    <KeyboardAccelerator Modifiers="Control" Key="P" />
                                </AppBarButton.KeyboardAccelerators>
                            </AppBarButton>
                            <AppBarButton x:Name="SetAsButton" Label="Set As">
                                <AppBarButton.Flyout>
                                    <MenuFlyout>
                                        <MenuFlyoutItem Text="Lock screen">
                                            <MenuFlyoutItem.Icon>
                                                <FontIcon Glyph="&#xEE3F;" />
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>
                                        <MenuFlyoutItem Text="Background">
                                            <MenuFlyoutItem.Icon>
                                                <FontIcon Glyph="&#xEB9F;" />
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>

                                    </MenuFlyout>
                                </AppBarButton.Flyout>
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE771;" />
                                </AppBarButton.Icon>
                            </AppBarButton>
                            <AppBarSeparator/>

                            <AppBarButton x:Name="FileInformationButton" Label="File Information"
                                          Click="FileInformationButton_Click">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE946;" />
                                </AppBarButton.Icon>
                            </AppBarButton>

                            <AppBarButton x:Name="FileExplorerButton" Label="Show in File Explorer">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xEC50;" />
                                </AppBarButton.Icon>
                            </AppBarButton>

                        </CommandBar.SecondaryCommands>
                    </CommandBar>


                    <Grid x:Name="CustomDragRegion" 
                        Height="50" VerticalAlignment="Top" 
                        Margin="0,-10,0,0"
                        Grid.Column="2"
                        x:FieldModifier="public"/>

                    
                    <StackPanel x:Name="FileInfo" Margin="0,8,0,0" Grid.Column="2" HorizontalAlignment="Left">

                        <TextBlock x:Name="FileName"
                                Text="{Binding FileName, UpdateSourceTrigger=PropertyChanged}"
                                FontSize="12"
                                TextTrimming="CharacterEllipsis"
                                TextWrapping="NoWrap"
                                HorizontalAlignment="Left"/>

                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <FontIcon Glyph="&#xE61F;" FontSize="10" Margin="0,1,0,0"/>
                            <TextBlock x:Name="Resolution"
                                Text="{Binding Resolution, UpdateSourceTrigger=PropertyChanged}" 
                                FontSize="12"
                                TextTrimming="CharacterEllipsis"
                                TextWrapping="NoWrap"/>
                            <FontIcon Glyph="&#xE799;" FontSize="10" Margin="5,1,0,0"/>
                            <TextBlock x:Name="AspectRatio"
                                Text="{Binding AspectRatio, UpdateSourceTrigger=PropertyChanged}" 
                                FontSize="12"
                                TextTrimming="CharacterEllipsis"
                                TextWrapping="NoWrap"/>
                            <FontIcon Glyph="&#xE74E;" FontSize="10" Margin="5,1,0,0"/>
                            <TextBlock x:Name="FileSize"
                            Text="{Binding Size, UpdateSourceTrigger=PropertyChanged}" 
                            FontSize="12"
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="NoWrap"/>
                        </StackPanel>
                    </StackPanel>



                    <CommandBar x:Name="MediaControlsCommandBar"
                                HorizontalAlignment="Stretch" 
                                DefaultLabelPosition="Collapsed"
                                Grid.Column="3"
                                Background="Transparent">

                        <CommandBar.PrimaryCommands>
                            <AppBarElementContainer>

                            </AppBarElementContainer>

                            <AppBarToggleButton x:Name="FreeMoveButton" 
                                                x:FieldModifier="public"
                                                  Label="Free Move"     
                                                  ToolTipService.ToolTip="Free Move"
                                                  Tapped="FreeMoveButton_Tapped">
                                
                                <AppBarToggleButton.Icon>
                                    <FontIcon Glyph="&#xE759;" FontFamily="Segoe MDL2 Assets"/>
                                </AppBarToggleButton.Icon>
                            </AppBarToggleButton>

                            <AppBarSeparator/>

                            <AppBarToggleButton x:Name="PIPButton" 
                                  Label="Picture in Picture"
                                  Checked="PIPButton_Checked"
                                  Unchecked="PIPButton_Checked"
                                  ToolTipService.ToolTip="Top Most Window">

                                <AppBarToggleButton.Icon>
                                    <FontIcon Glyph="&#xEE49;" FontFamily="Segoe MDL2 Assets"/>
                                </AppBarToggleButton.Icon>
                            </AppBarToggleButton>

                            <AppBarSeparator/>
                            
                            <!--<AppBarToggleButton x:Name="FullscreenButton" 
                                          Label="Fullscreen" 
                                          Icon="FullScreen"
                                          ToolTipService.ToolTip="Full Screen"
                                          Tapped="FullscreenButton_Tapped"/>
                            <AppBarSeparator Visibility="{Binding ElementName=FullscreenButton, Path=Visibility}"/>-->
                        </CommandBar.PrimaryCommands>
                    </CommandBar>


                </Grid>

                <muxc:InfoBar MaxWidth="480"
                      Background="{ThemeResource CustomAcrylicBrush}"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Bottom"
                      Margin="0,0,0,20"
                      FontSize="12"
                      IsClosable="False"
                      IsIconVisible="False">
                    
                    <interactivity:Interaction.Behaviors>
                        <behaviors:StackedNotificationsBehavior x:Name="NotificationQueue" />
                    </interactivity:Interaction.Behaviors>
                </muxc:InfoBar>
            </Grid>
        </NavigationView.Content>

        <NavigationView.FooterMenuItems>
            <NavigationViewItem x:Name="Coffee" Content="Buy me a coffee" 
                            Visibility="{x:Bind MS:Settings.Current.Promotion, Mode=TwoWay,  
                                        UpdateSourceTrigger=PropertyChanged,
                                        Converter={StaticResource BoolToVisibilityConverter}}" 
                            SelectsOnInvoked="False"
                            Tapped="Coffee_Tapped">
                <NavigationViewItem.Icon>
                    <FontIcon Glyph="&#xEC32;" FontFamily="Segoe MDL2 Assets"/>
                </NavigationViewItem.Icon>
            </NavigationViewItem>

            <NavigationViewItem x:Name="Suggestion" Content="Suggest a Feature" 
                            Visibility="{x:Bind MS:Settings.Current.Promotion, Mode=TwoWay, 
                                        UpdateSourceTrigger=PropertyChanged,
                                        Converter={StaticResource BoolToVisibilityConverter}}" 
                            SelectsOnInvoked="False"
                            Tapped="Suggestion_Tapped">
                <NavigationViewItem.Icon>
                    <FontIcon Glyph="&#xED15;" FontFamily="Segoe MDL2 Assets"/>
                </NavigationViewItem.Icon>
            </NavigationViewItem>

        </NavigationView.FooterMenuItems>
                        
    </NavigationView>


</Page>
