<Page
    x:Class="MediaViewer.MiniPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MediaViewer"
    xmlns:models="using:MediaViewer.Models"
    xmlns:controls="using:MediaViewer.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    SizeChanged="Page_SizeChanged"
    MinWidth="300"
    mc:Ignorable="d">

    <Page.Resources>
        <!-- Converter for selected item background -->
        <local:SelectedBackgroundConverter x:Key="SelectedBackgroundConverter"/>
        
        <!-- Converter for play/pause icon -->
        <local:PlayingIconConverter x:Key="PlayingIconConverter"/>
        
        <!-- Converter for playing item color -->
        <local:PlayingColorConverter x:Key="PlayingColorConverter"/>
    </Page.Resources>

    <Grid Background="#222">
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition Height="*" />
            <RowDefinition Height="100" />
        </Grid.RowDefinitions>

        <!-- Header (now inside NavigationView content) -->
        <Grid Grid.Row="0" Background="#161616" Padding="8,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Left" 
                        VerticalAlignment="Center">

                <!-- Toggle buttons for narrow view -->
                <StackPanel x:Name="ViewToggleButtons" Orientation="Horizontal" Visibility="Collapsed">
                    <ToggleButton x:Name="ShowAlbumArtButton" 
                                    Background="Transparent" 
                                    BorderBrush="Transparent" 
                                    IsChecked="True" 
                                    Click="ShowAlbumArtButton_Click">
                        <FontIcon Glyph="&#xE768;" Foreground="#FFF" />
                    </ToggleButton>

                    <ToggleButton x:Name="ShowPlaylistButton" 
                                    Background="Transparent" 
                                    BorderBrush="Transparent" 
                                    IsChecked="False" 
                                    Click="ShowPlaylistButton_Click">
                        <FontIcon Glyph="&#xE142;" Foreground="#FFF" />
                    </ToggleButton>
                </StackPanel>

                <!-- Playlist Name (Only if user specified) -->
                <TextBlock  x:Name="WindowTitle"
                            Text="Playlist" 
                            Margin="5,0,0,0" 
                            FontWeight="Bold"
                            FontSize="18"
                            VerticalAlignment="Center"/>

            </StackPanel>

            <TextBlock Grid.Column="1" Text="" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0" />
        </Grid>

        <!-- Main content -->
        <Grid x:Name="ContentGrid" Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="PlaylistColumn" Width="auto" MinWidth="300" />
                <ColumnDefinition x:Name="AlbumArtColumn" Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Playlist -->
            <Border x:Name="PlaylistView" 
                    Grid.Column="0" 
                    Background="#2A2A2A" 
                    Padding="8" 
                    BorderBrush="#1A1A1A" 
                    BorderThickness="0,0,1,0">

                <ListView x:Name="FileList" 
                          Background="Transparent" 
                          BorderThickness="0"
                          ItemsSource="{x:Bind playlist, Mode=OneWay}"
                          SelectionMode="Single"
                          SelectionChanged="FileList_SelectionChanged">
                    <ListView.Header>
                        <AutoSuggestBox PlaceholderText="Search" 
                                      QueryIcon="Find" 
                                      Margin="0,0,0,5"
                                      TextChanged="SearchBox_TextChanged"/>
                    </ListView.Header>

                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:AudioPlaylistItem">
                            <Grid Padding="5,8,15,8" 
                                  ColumnSpacing="10"
                                  Background="{x:Bind IsSelected, Mode=OneWay, Converter={StaticResource SelectedBackgroundConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="32" />
                                    <ColumnDefinition Width="28" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="60" />
                                </Grid.ColumnDefinitions>

                                <!-- Track Number -->
                                <TextBlock Grid.Column="0"
                                         Text="{x:Bind TrackNumber}"
                                         VerticalAlignment="Center"
                                         HorizontalAlignment="Right"
                                         FontSize="13"
                                         Opacity="0.6"
                                         Margin="0,0,8,0"/>

                                <!-- Play Button / Now Playing Indicator -->
                                <Button Grid.Column="1"
                                      Width="28"
                                      Height="28"
                                      Padding="0"
                                      Background="Transparent"
                                      BorderBrush="Transparent"
                                      Click="PlayTrackButton_Click"
                                      Tag="{x:Bind}"
                                      VerticalAlignment="Center">
                                    <FontIcon Glyph="{x:Bind IsPlaying, Mode=OneWay, Converter={StaticResource PlayingIconConverter}}" 
                                            FontSize="14"
                                            Foreground="{x:Bind IsPlaying, Mode=OneWay, Converter={StaticResource PlayingColorConverter}}"/>
                                </Button>

                                <!-- Track Info -->
                                <StackPanel Grid.Column="2" 
                                          VerticalAlignment="Center"
                                          Spacing="2">
                                    <TextBlock Text="{x:Bind DisplayTitle, Mode=OneWay}" 
                                             FontWeight="SemiBold"
                                             TextTrimming="CharacterEllipsis"
                                             FontSize="13"/>
                                    <TextBlock FontSize="11"
                                             Opacity="0.7"
                                             TextTrimming="CharacterEllipsis">
                                        <Run Text="{x:Bind DisplayArtist, Mode=OneWay}"/>
                                        <Run Text=" â€¢ "/>
                                        <Run Text="{x:Bind Properties.Album, Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Duration -->
                                <TextBlock Grid.Column="3" 
                                         Text="{x:Bind DisplayDuration, Mode=OneWay}"
                                         HorizontalAlignment="Right" 
                                         VerticalAlignment="Center"
                                         FontSize="12"
                                         Opacity="0.6"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>

                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0,0,0,1"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
            </Border>

            <!-- Album art -->
            <Pivot x:Name="AlbumArtView" Background="#2B2B2B" Grid.Column="1">
                <PivotItem Header="Artwork">
                    <Viewbox Stretch="Uniform">
                        <Grid Width="520" Height="420">
                            <Image x:Name="AlbumArtwork" 
                                   Stretch="UniformToFill"
                                   AllowDrop="True"
                                   DragOver="AlbumArtwork_DragOver"
                                   Drop="AlbumArtwork_Drop"
                                   Tapped="AlbumArtwork_Tapped"/>

                            <Border x:Name="AlbumPlaceholder"
                                Background="#FFF" 
                                HorizontalAlignment="Stretch" 
                                VerticalAlignment="Stretch" 
                                BorderThickness="8" 
                                BorderBrush="#2B2B2B">
                                <TextBlock Text="Add Album Art" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center" 
                                    Foreground="#999" 
                                    FontSize="20" />
                            </Border>
                        </Grid>
                    </Viewbox>
                </PivotItem>
                <PivotItem Header="Lyrics">
                    <Grid Padding="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Song Lyrics" 
                                 FontSize="18" 
                                 FontWeight="SemiBold" 
                                 Margin="0,0,0,15"
                                 Grid.Row="0"/>

                        <RichEditBox x:Name="LyricsRichEditBox"
                                   Grid.Row="1"
                                   PlaceholderText="Enter song lyrics here..."
                                   AcceptsReturn="True"
                                   TextWrapping="Wrap"
                                   DataContextChanged="LyricsRichEditBox_DataContextChanged"
                                   LostFocus="LyricsRichEditBox_LostFocus"
                                   FontFamily="Segoe UI"
                                   FontSize="14"/>

                        <StackPanel Grid.Row="2" 
                                  Orientation="Horizontal" 
                                  HorizontalAlignment="Right" 
                                  Spacing="10"
                                  Margin="0,10,0,0">
                            <Button x:Name="ClearLyricsButton"
                                  Content="Clear"
                                  Click="ClearLyricsButton_Click"/>
                            <Button x:Name="SearchLyricsButton"
                                  Content="Search Online"
                                  Style="{StaticResource AccentButtonStyle}"
                                  Click="SearchLyricsButton_Click"/>
                        </StackPanel>
                    </Grid>
                </PivotItem>
                <PivotItem Header="Properties">
                    <ScrollViewer Padding="20,15,20,15">
                        <StackPanel Spacing="20" MaxWidth="500">
                            
                            <!-- Title -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <SymbolIcon Symbol="MusicInfo" 
                                          Grid.Column="0"
                                          VerticalAlignment="Center"
                                          Margin="0,0,12,0"
                                          ToolTipService.ToolTip="Title"/>
                                
                                <TextBox x:Name="TitleTextBox"
                                       Grid.Column="1"
                                       Header="Title"
                                       PlaceholderText="Enter song title"
                                       TextChanged="TitleTextBox_TextChanged"/>
                            </Grid>

                            <!-- Artist -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <FontIcon Glyph="&#xE77B;" 
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Margin="0,0,12,0"
                                        ToolTipService.ToolTip="Artist"/>
                                
                                <TextBox x:Name="ArtistTextBox"
                                       Grid.Column="1"
                                       Header="Artist"
                                       PlaceholderText="Enter artist name"
                                       TextChanged="ArtistTextBox_TextChanged"/>
                            </Grid>

                            <!-- Album -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <FontIcon Glyph="&#xE93C;" 
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Margin="0,0,12,0"
                                        ToolTipService.ToolTip="Album"/>
                                
                                <TextBox x:Name="AlbumTextBox"
                                       Grid.Column="1"
                                       Header="Album"
                                       PlaceholderText="Enter album name"
                                       TextChanged="AlbumTextBox_TextChanged"/>
                            </Grid>

                            <!-- Genre -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <FontIcon Glyph="&#xEC4F;" 
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Margin="0,0,12,0"
                                        ToolTipService.ToolTip="Genre"/>
                                
                                <TextBox x:Name="GenreTextBox"
                                       Grid.Column="1"
                                       Header="Genre"
                                       PlaceholderText="Enter genre"
                                       TextChanged="GenreTextBox_TextChanged"/>
                            </Grid>

                            <!-- Year -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <SymbolIcon Symbol="Calendar" 
                                          Grid.Column="0"
                                          VerticalAlignment="Center"
                                          Margin="0,0,12,0"
                                          ToolTipService.ToolTip="Year"/>
                                
                                <NumberBox x:Name="YearNumberBox"
                                         Grid.Column="1"
                                         Header="Year"
                                         PlaceholderText="Enter year"
                                         SpinButtonPlacementMode="Inline"
                                         Minimum="1900"
                                         Maximum="2100"
                                         ValueChanged="YearNumberBox_ValueChanged"/>
                            </Grid>

                            <!-- Track Number -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <FontIcon Glyph="&#xE8FD;" 
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Margin="0,0,12,0"
                                        ToolTipService.ToolTip="Track Number"/>
                                
                                <NumberBox x:Name="TrackNumberBox"
                                         Grid.Column="1"
                                         Header="Track Number"
                                         PlaceholderText="Enter track #"
                                         SpinButtonPlacementMode="Inline"
                                         Minimum="0"
                                         ValueChanged="TrackNumberBox_ValueChanged"/>
                            </Grid>

                            <!-- Comments -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <SymbolIcon Symbol="AlignLeft" 
                                          Grid.Column="0"
                                          VerticalAlignment="Top"
                                          Margin="0,8,12,0"
                                          ToolTipService.ToolTip="Comments"/>
                                
                                <RichEditBox x:Name="CommentsRichEditBox"
                                           Grid.Column="1"
                                           Header="Comments"
                                           PlaceholderText="Add comments"
                                           MinHeight="80"
                                           MaxHeight="150"
                                           DataContextChanged="CommentsRichEditBox_DataContextChanged"
                                           LostFocus="CommentsRichEditBox_LostFocus"/>
                            </Grid>

                            <!-- Rating -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <SymbolIcon Symbol="LikeDislike" 
                                          Grid.Column="0"
                                          VerticalAlignment="Center"
                                          Margin="0,0,12,0"
                                          ToolTipService.ToolTip="Rating"/>
                                
                                <RatingControl x:Name="FileRatingControl"
                                             Grid.Column="1"
                                             Caption="Rating"
                                             DataContextChanged="FileRatingControl_DataContextChanged"
                                             ValueChanged="FileRatingControl_ValueChanged"/>
                            </Grid>

                            <!-- File Information Section -->
                            <Border BorderThickness="0,1,0,0" 
                                  BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                  Padding="0,20,0,0">
                                <StackPanel Spacing="15">
                                    <TextBlock Text="File Information" 
                                             FontWeight="SemiBold"
                                             FontSize="16"/>
                                    
                                    <!-- File Path -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Text="Path:" 
                                                 Grid.Column="0"
                                                 Opacity="0.7"/>
                                        <TextBlock x:Name="FilePathText"
                                                 Grid.Column="1"
                                                 TextWrapping="Wrap"
                                                 IsTextSelectionEnabled="True"/>
                                    </Grid>

                                    <!-- File Size -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Text="Size:" 
                                                 Grid.Column="0"
                                                 Opacity="0.7"/>
                                        <TextBlock x:Name="FileSizeText"
                                                 Grid.Column="1"/>
                                    </Grid>

                                    <!-- Bit Rate -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Text="Bit Rate:" 
                                                 Grid.Column="0"
                                                 Opacity="0.7"/>
                                        <TextBlock x:Name="BitRateText"
                                                 Grid.Column="1"/>
                                    </Grid>

                                    <!-- Sample Rate -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Text="Sample Rate:" 
                                                 Grid.Column="0"
                                                 Opacity="0.7"/>
                                        <TextBlock x:Name="SampleRateText"
                                                 Grid.Column="1"/>
                                    </Grid>

                                    <!-- Duration -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Text="Duration:" 
                                                 Grid.Column="0"
                                                 Opacity="0.7"/>
                                        <TextBlock x:Name="DurationText"
                                                 Grid.Column="1"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </PivotItem>
            </Pivot>

            <toolkit:GridSplitter 
                        x:Name="ContentSplitter"
                        Grid.Column="1"
                        Width="15"
                        HorizontalAlignment="Left"
                        ResizeBehavior="BasedOnAlignment"
                        ResizeDirection="Columns">

                <toolkit:GridSplitter.RenderTransform>
                    <TranslateTransform X="-7" />
                </toolkit:GridSplitter.RenderTransform>
            </toolkit:GridSplitter>
        </Grid>


        <!-- Bottom area: transport UI container -->
        <Grid Grid.Row="2">
            <!-- Single-select transport bar (adopts selected item when in single mode) -->
            <Border x:Name="SingleTransportBar" 
                    Background="#0F0F0F" 
                    BorderBrush="#222" 
                    BorderThickness="1,1,1,0" 
                    Padding="12" 
                    HorizontalAlignment="Stretch" 
                    VerticalAlignment="Stretch">

                <Grid>
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="TransportSizeStates">
                            <VisualState x:Name="WideTransport">
                                <VisualState.StateTriggers>
                                    <AdaptiveTrigger MinWindowWidth="600" />
                                </VisualState.StateTriggers>
                                <VisualState.Setters>
                                    <!-- Wide layout: Single row with 3 columns -->
                                    <Setter Target="TransportGrid.RowDefinitions[0].Height" Value="*" />
                                    <Setter Target="TransportGrid.RowDefinitions[1].Height" Value="0" />
                                    <Setter Target="LeftControls.(Grid.Row)" Value="0" />
                                    <Setter Target="LeftControls.(Grid.Column)" Value="0" />
                                    <Setter Target="CenterControls.(Grid.Row)" Value="0" />
                                    <Setter Target="CenterControls.(Grid.Column)" Value="1" />
                                    <Setter Target="CenterControls.(Grid.ColumnSpan)" Value="1" />
                                    <Setter Target="RightControls.(Grid.Row)" Value="0" />
                                    <Setter Target="RightControls.(Grid.Column)" Value="2" />
                                    <Setter Target="RightControls.Visibility" Value="Visible" />
                                    <Setter Target="TransportTitle.Visibility" Value="Visible" />
                                </VisualState.Setters>
                            </VisualState>
                            <VisualState x:Name="NarrowTransport">
                                <VisualState.StateTriggers>
                                    <AdaptiveTrigger MinWindowWidth="0" />
                                </VisualState.StateTriggers>
                                <VisualState.Setters>
                                    <!-- Narrow layout: 2 rows, timeline on top spanning full width, controls below -->
                                    <Setter Target="TransportGrid.RowDefinitions[0].Height" Value="Auto" />
                                    <Setter Target="TransportGrid.RowDefinitions[1].Height" Value="*" />
                                    <Setter Target="LeftControls.(Grid.Row)" Value="1" />
                                    <Setter Target="LeftControls.(Grid.Column)" Value="0" />
                                    <Setter Target="LeftControls.(Grid.ColumnSpan)" Value="3" />
                                    <Setter Target="LeftControls.HorizontalAlignment" Value="Center" />
                                    <Setter Target="CenterControls.(Grid.Row)" Value="0" />
                                    <Setter Target="CenterControls.(Grid.Column)" Value="0" />
                                    <Setter Target="CenterControls.(Grid.ColumnSpan)" Value="3" />
                                    <Setter Target="RightControls.Visibility" Value="Collapsed" />
                                    <Setter Target="TransportTitle.Visibility" Value="Collapsed" />
                                    <Setter Target="ProgressGrid.Margin" Value="0" />
                                </VisualState.Setters>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>

                    <Grid x:Name="TransportGrid" ColumnSpacing="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="0" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.Resources>
                            <Style TargetType="Button" >
                                <Setter Target="Background" Value="Transparent"/>
                                <Setter Target="BorderBrush" Value="Transparent"/>
                            </Style>
                        </Grid.Resources>

                        <!-- Center: time, progress, title (top row in narrow, middle column in wide) -->
                        <StackPanel x:Name="CenterControls" 
                                    Grid.Row="0" 
                                    Grid.Column="1" 
                                    Orientation="Vertical" 
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Stretch">

                            <TextBlock x:Name="TransportTitle" 
                                        Text="Unknown - Scarlet Fire" 
                                        FontWeight="SemiBold" 
                                        HorizontalAlignment="Center" 
                                        Margin="0,0,0,6" />

                            <Grid x:Name="ProgressGrid" ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBlock x:Name="CurrentTimeText" 
                                            Text="00:00" 
                                            VerticalAlignment="Center" 
                                            FontSize="12" />

                                <Slider x:Name="ProgressSlider" 
                                        Grid.Column="1" 
                                        Minimum="0"
                                        Maximum="100" 
                                        Value="0" />

                                <TextBlock x:Name="TotalTimeText" 
                                            Grid.Column="2"
                                            Text="02:22" 
                                            VerticalAlignment="Center" 
                                            FontSize="12" />
                            </Grid>
                        </StackPanel>

                        <!-- Left controls: prev/play/next (bottom row in narrow, left column in wide) -->
                        <StackPanel x:Name="LeftControls" 
                                    Grid.Row="0" 
                                    Grid.Column="0" 
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Left" 
                                    Spacing="12">

                            <Button x:Name="PrevButton" 
                                    Click="PrevButton_Click"
                                    Width="48" 
                                    Height="48">
                                <FontIcon Glyph="&#xE100;" 
                                            FontSize="20"/>
                            </Button>

                            <Button x:Name="PlayPauseButton" 
                                    Click="PlayPauseButton_Click"
                                    Width="56" 
                                    Height="56">
                                <FontIcon Glyph="&#xE768;" FontSize="24" />
                            </Button>

                            <Button x:Name="NextButton" 
                                    Click="NextButton_Click"
                                    Width="48" 
                                    Height="48">

                                <FontIcon Glyph="&#xE893;" FontSize="20"/>
                            </Button>
                        </StackPanel>

                        <!-- Right controls: repeat/shuffle/volume/more (hidden in narrow, right column in wide) -->
                        <StackPanel x:Name="RightControls" 
                                    Grid.Row="0" 
                                    Grid.Column="2" 
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Right" 
                                    Spacing="12">

                            <Button x:Name="RepeatButton"
                                    Click="RepeatButton_Click">
                                <FontIcon Glyph="&#xE8EE;"/>
                            </Button>

                            <Button x:Name="ShuffleButton"
                                    Click="ShuffleButton_Click">
                                <FontIcon Glyph="&#xE8B1;" />
                            </Button>

                            <Button x:Name="VolumeButton">
                                <FontIcon Glyph="&#xE993;" />
                                <Button.Flyout>
                                    <Flyout Opening="VolumeFlyout_Opening" Placement="Top">
                                        <StackPanel Width="200" Spacing="10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <FontIcon Glyph="&#xE992;" 
                                                        Grid.Column="0"
                                                        FontSize="16"
                                                        Margin="0,0,10,0"/>

                                                <Slider x:Name="VolumeSlider"
                                                      Grid.Column="1"
                                                      Minimum="0"
                                                      Maximum="100"
                                                      Value="100"
                                                      ValueChanged="VolumeSlider_ValueChanged"
                                                      VerticalAlignment="Center"/>

                                                <FontIcon Glyph="&#xE995;" 
                                                        Grid.Column="2"
                                                        FontSize="16"
                                                        Margin="10,0,0,0"/>
                                            </Grid>

                                            <TextBlock x:Name="VolumePercentText"
                                                     Text="100%"
                                                     HorizontalAlignment="Center"
                                                     FontSize="14"
                                                     Opacity="0.8"/>

                                            <Button x:Name="MuteButton"
                                                  HorizontalAlignment="Stretch"
                                                  Click="MuteButton_Click">
                                                <Button.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon x:Name="MuteIcon" Glyph="&#xE74F;" FontSize="14"/>
                                                        <TextBlock x:Name="MuteText" Text="Mute"/>
                                                    </StackPanel>
                                                </Button.Content>
                                            </Button>
                                        </StackPanel>
                                    </Flyout>
                                </Button.Flyout>
                            </Button>

                            <Button x:Name="MoreButton">
                                <Button.Content>
                                    <FontIcon Glyph="&#xE712;" />
                                </Button.Content>
                                <Button.Flyout>
                                    <MenuFlyout>
                                        <MenuFlyoutItem Text="Edit">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Edit"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutSeparator/>

                                        <MenuFlyoutItem Text="Copy File">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Copy"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutItem Text="Copy as Path">
                                            <MenuFlyoutItem.Icon>
                                                <FontIcon Glyph="&#xE62F;"/>
                                            </MenuFlyoutItem.Icon>
                                            <MenuFlyoutItem.KeyboardAccelerators>
                                                <KeyboardAccelerator Modifiers="Control" Key="C"/>
                                            </MenuFlyoutItem.KeyboardAccelerators>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutItem Text="Show in File Explorer">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="OpenFile"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutSeparator/>

                                        <MenuFlyoutItem Text="Save Playlist">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="SaveLocal"/>
                                            </MenuFlyoutItem.Icon>
                                            <MenuFlyoutItem.KeyboardAccelerators>
                                                <KeyboardAccelerator Modifiers="Control" Key="S"/>
                                            </MenuFlyoutItem.KeyboardAccelerators>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutItem Text="Add to Playlist">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Add"/>
                                            </MenuFlyoutItem.Icon>
                                            <MenuFlyoutItem.KeyboardAccelerators>
                                                <KeyboardAccelerator Modifiers="Control" Key="A"/>
                                            </MenuFlyoutItem.KeyboardAccelerators>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutItem Text="Clear Playlist">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Clear"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>

                                        <MenuFlyoutSeparator/>


                                        <MenuFlyoutSubItem Text="Playback Rate">
                                            <MenuFlyoutSubItem.Icon>
                                                <FontIcon Glyph="&#xEC57;"/>
                                            </MenuFlyoutSubItem.Icon>
                                            <MenuFlyoutSubItem.Items>
                                                <RadioMenuFlyoutItem Text="0.25" GroupName="PlaybackRate"/>
                                                <RadioMenuFlyoutItem Text="0.50" GroupName="PlaybackRate"/>
                                                <RadioMenuFlyoutItem Text="1.00" GroupName="PlaybackRate" IsChecked="True" />
                                                <RadioMenuFlyoutItem Text="1.25" GroupName="PlaybackRate"/>
                                                <RadioMenuFlyoutItem Text="1.50" GroupName="PlaybackRate"/>
                                                <RadioMenuFlyoutItem Text="1.75" GroupName="PlaybackRate"/>
                                                <RadioMenuFlyoutItem Text="2.00" GroupName="PlaybackRate"/>
                                            </MenuFlyoutSubItem.Items>
                                        </MenuFlyoutSubItem>

                                        
                                        <MenuFlyoutSubItem Text="Reverb">
                                            <MenuFlyoutSubItem.Icon>
                                                <FontIcon Glyph="&#xE93E;"/>
                                            </MenuFlyoutSubItem.Icon>
                                            <MenuFlyoutSubItem.Items>
                                                <MenuFlyoutItem>
                                                    <MenuFlyoutItem.Template>
                                                        <ControlTemplate>
                                                            <StackPanel Padding="15,15,15,5" Spacing="5">
                                                                <ToggleSwitch OnContent="Enabled" 
                                                                              OffContent="Enabled"
                                                                              HorizontalAlignment="Left"/>

                                                                <StackPanel Orientation="Horizontal" Spacing="5">
                                                                    <Slider
                                                                        Header="Amount"
                                                                        Width="180"
                                                                        Minimum="0"
                                                                        Maximum="100"
                                                                        Value=""
                                                                        SmallChange="1"
                                                                        LargeChange="10"/>

                                                                    <TextBlock Text="%" 
                                                                        VerticalAlignment="Center"
                                                                        Margin="0,15,0,0"
                                                                        FontSize="22"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </ControlTemplate>
                                                    </MenuFlyoutItem.Template>
                                                </MenuFlyoutItem>
                                            </MenuFlyoutSubItem.Items>
                                        </MenuFlyoutSubItem>

                                        <MenuFlyoutSeparator/>

                                        <MenuFlyoutItem Text="Settings">
                                            <MenuFlyoutItem.Icon>
                                                <SymbolIcon Symbol="Setting"/>
                                            </MenuFlyoutItem.Icon>
                                        </MenuFlyoutItem>
                                    </MenuFlyout>
                                </Button.Flyout>
                            </Button>

                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Per-item AudioPlayer reserved for each playlist item. Keep collapsed by default; code will show/hide as needed. -->
            <controls:AudioPlayer x:Name="AudioPlay" Visibility="Collapsed" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
        </Grid>
    </Grid>

</Page>